"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[437],{437:function(e,t,a){a.r(t);var s=a(5893),r=a(1701),n=a(9149),l=a(58),c=a(6154);a(1259);var i=a(7294),o=a(9583),d=a(5434),u=a(1796),p=a.n(u);let m=e=>{let{hide:t}=e,[{userInfo:a,currentChatUser:u,socket:m},f]=(0,r.C4)(),[h,x]=(0,i.useState)(!1),[g,j]=(0,i.useState)(0),[v,S]=(0,i.useState)(0),[w,N]=(0,i.useState)(0),[C,E]=(0,i.useState)(null),[b,k]=(0,i.useState)(null),y=(0,i.useRef)(null),L=(0,i.useRef)(null),R=(0,i.useRef)(null);(0,i.useEffect)(()=>{let e;return h&&(e=setInterval(()=>{j(e=>(N(e+1),e+1))},1e3)),()=>{clearInterval(e)}},[h]),(0,i.useEffect)(()=>{let e=p().create({container:R.current,waveColor:"#ccc",progressColor:"#4a9eff",cursorColor:"#7ae3c3",barWidth:2,height:30,responsive:!0});return E(e),e.on("finish",()=>{G(!1)}),()=>{e.destroy()}},[]),(0,i.useEffect)(()=>{C&&M()},[C]);let M=()=>{j(0),S(0),N(0),x(!0),navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{let t=new MediaRecorder(e);L.current=t,y.current.srcObject=e;let a=[];t.ondataavailable=e=>a.push(e.data),t.onstop=()=>{let e=new Blob(a,{type:"audio/ogg; codecs=opus"}),t=URL.createObjectURL(e),s=new Audio(t);k(s),C.load(t)},t.start()}).catch(e=>{console.error("Error accessing microphone:",e)})},[D,_]=(0,i.useState)(null),A=()=>{if(L.current&&h){L.current.stop(),x(!1),C.stop();let e=[];L.current.addEventListener("dataavailable",t=>{e.push(t.data)}),L.current.addEventListener("stop",()=>{let t=new Blob(e,{type:"audio/mp3"}),a=new File([t],"recording.mp3");_(a)})}},[F,G]=(0,i.useState)(!1),O=()=>{b&&(C.stop(),C.play(),b.play(),G(!0))},U=()=>{C.stop(),b.pause(),G(!1)},B=e=>isNaN(e)?"00:00":"".concat(Math.floor(e/60).toString().padStart(2,"0"),":").concat(Math.floor(e%60).toString().padStart(2,"0"));(0,i.useEffect)(()=>{if(b){let e=()=>{S(b.currentTime)};return b.addEventListener("timeupdate",e),()=>{b.removeEventListener("timeupdate",e)}}},[b]);let I=async()=>{try{let e=new FormData;e.append("audio",D);let s=await c.Z.post(l.OZ,e,{headers:{"Content-Type":"multipart/form-data"},params:{from:a.id,to:u.id}});201===s.status&&(m.current.emit("send-msg",{to:u.id,from:a.id,message:s.data.message}),f({type:n.J.ADD_MESSAGE,newMessage:{...s.data.message},fromSelf:!0}),t())}catch(e){console.log(e)}};return(0,s.jsxs)("div",{className:"flex text-2xl w-full justify-end items-center",children:[(0,s.jsx)("div",{className:"pt-1",children:(0,s.jsx)(o.Xm5,{className:"text-panel-header-icon",onClick:()=>t()})}),(0,s.jsxs)("div",{className:"mx-4 py-2 px-4 text-white text-lg flex gap-3 justify-center items-center bg-search-input-container-background rounded-full drop-shadow-lg",children:[h?(0,s.jsxs)("div",{className:"text-red-500 animate-blink w-60 text-center",children:["Recording ",(0,s.jsxs)("span",{children:["(",g,"s)"]})]}):(0,s.jsx)("div",{className:" ",children:b&&(0,s.jsx)(s.Fragment,{children:F?(0,s.jsx)(o.JuG,{onClick:U}):(0,s.jsx)(o.gmG,{onClick:O})})}),(0,s.jsx)("div",{className:"w-60",ref:R,hidden:h}),b&&F&&(0,s.jsx)("span",{children:B(v)}),b&&!F&&(0,s.jsx)("span",{children:B(w)}),(0,s.jsx)("audio",{ref:y,hidden:!0})]}),(0,s.jsx)("div",{className:"mr-4 ",children:h?(0,s.jsx)(o.x00,{className:"text-red-500",onClick:A}):(0,s.jsx)(o.uYL,{className:"text-red-500",onClick:M})}),(0,s.jsx)("div",{children:(0,s.jsx)(d.D6S,{className:"text-panel-header-icon cursor-pointer mr-4 ",title:"Send",onClick:I})})]})};t.default=m}}]);