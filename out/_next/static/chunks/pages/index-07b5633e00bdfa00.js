(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5728:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(812)}])},8:function(e,t,a){"use strict";a.r(t);var s=a(5893),l=a(1701),n=a(9149),r=a(58),c=a(6154),i=a(5675),o=a.n(i),d=a(7294),u=a(5434);a(5152),t.default=function(e){let{data:t}=e,[{socket:i,userInfo:m},x]=(0,l.C4)(),[p,f]=(0,d.useState)(void 0),[g,h]=(0,d.useState)(void 0),[v,j]=(0,d.useState)(void 0),[y,N]=(0,d.useState)(void 0),[b,w]=(0,d.useState)(!1);(0,d.useEffect)(()=>{"out-going"===t.type?i.current.on("accept-call",()=>w(!0)):setTimeout(()=>{w(!0)},1e3)},[t]),(0,d.useEffect)(()=>{let e=async()=>{try{let{data:{token:e}}=await c.Z.get("".concat(r.MZ,"/").concat(m.id));j(e)}catch(e){console.log(e)}};b&&e()},[b]),(0,d.useEffect)(()=>{let e=async()=>{Promise.all([a.e(43),a.e(683),a.e(914)]).then(a.t.bind(a,3399,23)).then(async e=>{let{ZegoExpressEngine:a}=e,s=new a(763131272,"c104caf295b5132ab9219ea68f74e24b");N(s),s.on("roomStreamUpdate",async(e,a,r,c)=>{if("ADD"==a){let e=document.getElementById("remote-video"),a=document.createElement("video"===t.callType?"video":"audio");a.id=r[0].streamID,a.autoplay=!0,a.playsInline=!0,a.muted=!1,e&&e.appendChild(a),s.startPlayingStream(r[0].streamID,{audio:!0,video:!0}).then(e=>{a.srcObject=e})}else"DELETE"==a&&s&&l&&r[0].streamID&&(s.destroyStream(l),s.stopPublishingStream(r[0].streamID),s.logoutRoom(t.roomId.toString()),x({type:n.J.END_CALL}))}),await s.loginRoom(t.roomId.toString(),v,{userID:m.id.toString(),userName:m.name},{userUpdate:!0});let l=await s.createStream({camera:{audio:!0,video:"video"===t.callType}}),r=document.getElementById("local-video"),c=document.createElement("video"===t.callType?"video":"audio");c.id="audio-local",c.className="h-28 w-32",c.autoplay=!0,c.muted=!1,c.playsInline=!0,r.appendChild(c);let i=document.getElementById("audio-local");i.srcObject=l;let o="123"+Date.now();h(o),f(l),s.startPublishingStream(o,l)})};v&&e()},[v]);let C=()=>{let e=t.id;i.current.emit("reject-voice-call",{from:e}),y&&p&&g&&(y.destroyStream(p),y.stopPublishingStream(g),y.logoutRoom(t.roomId.toString())),x({type:n.J.END_CALL})};return(0,s.jsxs)("div",{className:"border-conversation-border border-l w-full bg-conversation-panel-background flex flex-col h-[100vh] overflow-hidden items-center justify-center text-white ",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-3 items-center",children:[(0,s.jsx)("span",{className:"text-5xl",children:t.name}),(0,s.jsx)("span",{className:"text-lg",children:b&&"video"!==t.callType?"On going call":"Calling"})]}),(!b||"audio"===t.callType)&&(0,s.jsx)("div",{className:"my-24",children:(0,s.jsx)(o(),{src:t.profilePicture,alt:"avatar",height:300,width:300,className:"rounded-full"})}),(0,s.jsx)("div",{className:"my-5 relative",id:"remote-video",children:(0,s.jsx)("div",{className:"absolute bottom-5 right-5",id:"local-video"})}),(0,s.jsx)("div",{className:"rounded-full h-16 w-16 bg-red-600 flex items-center justify-center",onClick:C,children:(0,s.jsx)(u.hoo,{className:"text-3xl cursor-pointer"})})]})}},9352:function(e,t,a){"use strict";a.d(t,{Z:function(){return u}});var s=a(5893),l=a(7294),n=a(9583),r=a(9413),c=a(6223),i=a(155);function o(e){let{setImage:t,hidePhotoLibrary:a}=e;return(0,s.jsx)("div",{className:"fixed top-0 left-0 max-h-[100vh] max-w-[100vw] h-full w-full flex justify-center items-center",children:(0,s.jsxs)("div",{className:" h-max w-max   bg-gray-900  gap-6 rounded-lg p-4",children:[(0,s.jsx)("div",{className:"pt-2 pr-2 cursor-pointer flex items-end justify-end",onClick:()=>a(!1),children:(0,s.jsx)(i.bjh,{className:"h-10 w-10"})}),(0,s.jsx)("div",{className:"grid grid-cols-3 justify-center items-center  gap-16 p-20 w-full",children:["avatars/1.png","avatars/2.png","avatars/3.png","avatars/4.png","avatars/5.png","avatars/6.png","avatars/7.png","avatars/8.png","avatars/9.png"].map((e,l)=>(0,s.jsx)("div",{onClick:async()=>{let s=document.querySelector("[data-avatar=avatar-".concat(l,"]")),n=await fetch(null==s?void 0:s.src);await n.blob();let r=new FileReader;r.onloadend=()=>{t(r.result)},a(!1),t(e)},className:"cursor-pointer",children:(0,s.jsx)("img",{src:e,alt:"avatar",className:"h-24 w-24","data-avatar":"avatar-".concat(l)})},e))})]})})}function d(e){let{setImage:t,hide:a}=e,n=(0,l.useRef)();(0,l.useEffect)(()=>{let e;let t=async()=>{e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),n.current.srcObject=e};return t(),()=>{null==e||e.getTracks().forEach(e=>e.stop())}},[]);let r=()=>{var e;let s=document.createElement("canvas");null===(e=s.getContext("2d"))||void 0===e||e.drawImage(n.current,0,0,300,150),t(s.toDataURL("image/jpeg")),a(!1)};return(0,s.jsxs)("div",{className:"absolute h-4/6 w-2/6 top-1/4 left-1/3 bg-gray-900 flex-col gap-3 rounded-lg pt-2 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-4 w-full",children:[(0,s.jsx)("div",{className:"pt-2 pr-2 cursor-pointer flex items-end justify-end",onClick:()=>a(!1),children:(0,s.jsx)(i.bjh,{className:"h-10 w-10"})}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)("video",{id:"video",width:"400",autoPlay:!0,ref:n})})]}),(0,s.jsx)("button",{className:" h-16 w-16 bg-white rounded-full cursor-pointer border-8 border-teal-light p-2 mb-10",onClick:r})]})}function u(e){let{type:t,image:a,setImage:i}=e,[u,m]=(0,l.useState)(!1),[x,p]=(0,l.useState)(!1),[f,g]=(0,l.useState)(!1),[h,v]=(0,l.useState)(!1),[j,y]=(0,l.useState)(!0),[N,b]=(0,l.useState)(!1),[w,C]=(0,l.useState)({x:0,y:0});(0,l.useEffect)(()=>{if(f){let e=document.getElementById("photo-picker");e.click(),document.body.onfocus=e=>{g(!1)}}},[f]),(0,l.useEffect)(()=>{let e=()=>{j?y(!1):(v(!1),y(!0))};return h&&window.addEventListener("click",e),()=>window.removeEventListener("click",e)},[h,j]);let E=e=>{e.preventDefault(),C({x:e.pageX,y:e.pageY}),v(!0)},S=async e=>{let t=e.target.files[0],a=new FileReader,s=document.createElement("img");a.onload=function(e){s.src=e.target.result,s.setAttribute("data-src",e.target.result)},a.readAsDataURL(t),setTimeout(()=>{i(s.src)},100)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center justify-center",children:["sm"===t&&(0,s.jsx)("img",{src:a,alt:"avatar",className:"h-10 w-10 rounded-full"}),"lg"===t&&(0,s.jsx)("img",{src:a,alt:"avatar",className:"h-14 w-14 rounded-full"}),"xl"===t&&(0,s.jsxs)("div",{className:"relative cursor-pointer z-0",onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),children:[(0,s.jsxs)("div",{className:"bg-photopicker-overlay-background h-60 w-60 absolute top-0 left-0 rounded-full flex items-center justify-center flex-col text-center gap-2 ".concat(u?"visible":"hidden"),id:"context-opener",onClick:e=>E(e),children:[(0,s.jsx)(n.Dmm,{className:"text-2xl",id:"context-opener",onClick:e=>E(e)}),(0,s.jsxs)("span",{className:"",id:"context-opener",onClick:e=>E(e),children:["Change ",(0,s.jsx)("br",{})," Profile ",(0,s.jsx)("br",{})," Photo"]})]}),(0,s.jsx)("div",{className:"flex items-center justify-center",children:(0,s.jsx)("img",{src:a,alt:"avatar",className:"h-60 w-60 rounded-full object-cover "})})]})]}),h&&(0,s.jsx)(r.Z,{options:[{name:"Take Photo",callBack:()=>{v(!1),b(!0)}},{name:"Choose from Library",callBack:()=>{v(!1),p(!0)}},{name:"Upload Photo",callBack:()=>{v(!1),g(!0)}},{name:"Remove Photo",callBack:()=>{v(!1),i("/default_avatar.png")}}],cordinates:w,contextMenu:h,setContextMenu:v}),f&&(0,s.jsx)(c.Z,{onChange:S}),x&&(0,s.jsx)(o,{setImage:i,hidePhotoLibrary:p}),N&&(0,s.jsx)(d,{setImage:i,hide:b})]})}},9413:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(5893),l=a(7294);function n(e){let{options:t,cordinates:a,contextMenu:n,setContextMenu:r}=e,c=(0,l.useRef)(null);(0,l.useEffect)(()=>{let e=e=>{"context-opener"!==e.target.id&&c.current&&!c.current.contains(e.target)&&r(!1)};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[]),(0,l.useEffect)(()=>{let e=e=>{"Escape"===e.key&&n&&r(!1)};return window.addEventListener("keyup",e),()=>window.removeEventListener("keyup",e)},[]);let i=(e,t)=>{e.stopPropagation(),t()};return(0,s.jsx)("div",{className:"bg-dropdown-background fixed py-2 z-[100]",ref:c,style:{boxShadow:"0 2px 5px 0 rgba(var(11,20,26),.26),0 2px 10px 0 rgba(11,20,26;),.16)",top:a.y,left:a.x},children:(0,s.jsx)("ul",{children:t.map(e=>{let{name:t,callBack:a}=e;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("li",{className:"hover:bg-background-default-hover px-5 py-2 cursor-pointer",onClick:e=>i(e,a),children:(0,s.jsx)("span",{className:"text-white",children:t})})})})})})}},2177:function(e,t,a){"use strict";var s=a(5893);a(7294);var l=a(3750);t.Z=function(e){let{messageStatus:t}=e;return(0,s.jsxs)(s.Fragment,{children:["sent"===t&&(0,s.jsx)(l.oFd,{className:"text-lg"}),"delivered"===t&&(0,s.jsx)(l.fC0,{className:"text-lg"}),"read"===t&&(0,s.jsx)(l.fC0,{className:"text-lg text-icon-ack"})]})}},6223:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(5893);a(7294);var l=a(3935);function n(e){let{onChange:t}=e,a=(0,s.jsx)("input",{type:"file",hidden:!0,id:"photo-picker",onChange:t});return l.createPortal(a,document.getElementById("photo-picker-element"))}},812:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return W}});var s=a(5893),l=a(1259),n=a(7294),r=a(3920),c=a(1701),i=a(5152),o=a.n(i),d=a(157),u=a(2177),m=a(58),x=a(5675),p=a.n(x),f=function(e){let{message:t}=e,[{currentChatUser:a,userInfo:l}]=(0,c.C4)();return(0,s.jsx)("div",{className:"p-1 rounded-lg ".concat(t.senderId===a.id?"bg-incoming-background":"bg-outgoing-background"),children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(p(),{src:"".concat(m.M5,"/").concat(t.message),className:"rounded-lg",alt:"asset",height:300,width:300}),(0,s.jsxs)("div",{className:"absolute bottom-1 right-1 flex items-end gap-1",children:[(0,s.jsx)("span",{className:"text-bubble-meta text-[11px] pt-1 min-w-fit",children:(0,d.O)(t.createdAt)}),(0,s.jsx)("span",{className:"text-bubble-meta",children:t.senderId===l.id&&(0,s.jsx)(u.Z,{messageStatus:t.messageStatus})})]})]})})};let g=o()(()=>Promise.all([a.e(33),a.e(398)]).then(a.bind(a,2398)),{loadableGenerated:{webpack:()=>[2398]},ssr:!1});function h(){let[{messages:e,currentChatUser:t,userInfo:a}]=(0,c.C4)(),l=(0,n.useRef)(null);return(0,n.useEffect)(()=>{let e=l.current,t=e.lastElementChild.lastElementChild.lastElementChild.lastElementChild;t&&t.scrollIntoView({behavior:"smooth"})},[e]),(0,s.jsxs)("div",{className:"h-[80vh] w-full relative flex-grow overflow-auto custom-scrollbar ",ref:l,children:[(0,s.jsx)("div",{className:"bg-chat-background bg-fixed h-full w-full opacity-5 fixed left-0 top-0 z-0"}),(0,s.jsx)("div",{className:"mx-10 my-6 relative bottom-0 z-40 left-0 ",children:(0,s.jsx)("div",{className:"flex w-full",children:(0,s.jsx)("div",{className:"flex flex-col justify-end w-full gap-1 overflow-auto",children:e.map((e,l)=>(0,s.jsxs)("div",{className:"flex ".concat(e.senderId===t.id?"justify-start":"justify-end"),children:["text"===e.type&&(0,s.jsxs)("div",{className:"text-white px-2 py-[5px] text-sm rounded-md flex gap-2 items-end max-w-[45%]	 ".concat(e.senderId===t.id?"bg-incoming-background":"bg-outgoing-background"),children:[(0,s.jsx)("span",{className:"break-all",children:e.message}),(0,s.jsxs)("div",{className:"flex gap-1 items-end",children:[(0,s.jsx)("span",{className:"text-bubble-meta text-[11px] pt-1 min-w-fit",children:(0,d.O)(e.createdAt)}),(0,s.jsx)("span",{children:e.senderId===a.id&&(0,s.jsx)(u.Z,{messageStatus:e.messageStatus})})]})]}),"image"===e.type&&(0,s.jsx)(f,{message:e}),"audio"===e.type&&(0,s.jsx)(g,{message:e})]},l))})})})]})}var v=a(9352),j=a(3750),y=a(7516),N=a(5434),b=a(155),w=a(9149),C=a(9413);function E(){let[{userInfo:e,currentChatUser:t,onlineUsers:a},l]=(0,c.C4)(),[r,i]=(0,n.useState)({x:0,y:0}),[o,d]=(0,n.useState)(!1),u=e=>{e.preventDefault(),i({x:e.pageX-50,y:e.pageY+20}),d(!0)},m=()=>{l({type:w.J.SET_VIDEO_CALL,videoCall:{...t,type:"out-going",callType:"video",roomId:Date.now()}})},x=()=>{l({type:w.J.SET_VOICE_CALL,voiceCall:{...t,type:"out-going",callType:"audio",roomId:Date.now()}})};return(0,s.jsxs)("div",{className:"h-16 px-4 py-3 flex justify-between items-center bg-panel-header-background z-10",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-6",children:[(0,s.jsx)(v.Z,{type:"sm",image:null==t?void 0:t.profilePicture}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-primary-strong",children:null==t?void 0:t.name}),(0,s.jsx)("span",{className:"text-secondary text-sm",children:a.includes(t.id)?"online":"offline"})]})]}),(0,s.jsxs)("div",{className:"flex gap-6 ",children:[(0,s.jsx)(N.fFs,{className:"text-panel-header-icon cursor-pointer text-xl",onClick:x}),(0,s.jsx)(b.giN,{className:"text-panel-header-icon cursor-pointer text-xl",onClick:m}),(0,s.jsx)(y.wnI,{className:"text-panel-header-icon cursor-pointer text-xl",onClick:()=>l({type:w.J.SET_MESSAGES_SEARCH})}),(0,s.jsx)(j.FQA,{className:"text-panel-header-icon cursor-pointer text-xl",onClick:e=>u(e),id:"context-opener"}),o&&(0,s.jsx)(C.Z,{options:[{name:"Exit",callBack:async()=>{d(!1),l({type:w.J.SET_EXIT_CHAT})}}],cordinates:r,contextMenu:o,setContextMenu:d})]})]})}var S=a(3990),k=a(9583),_=a(6154),I=a(3048),T=a(6223);let A=o()(()=>Promise.all([a.e(33),a.e(437)]).then(a.bind(a,437)),{loadableGenerated:{webpack:()=>[437]},ssr:!1});function L(){let[e,t]=(0,n.useState)(""),[a,l]=(0,n.useState)(!1),[r,i]=(0,n.useState)(!1),[o,d]=(0,n.useState)(!1),u=async e=>{let t=e.target.files[0];try{let e=new FormData;e.append("image",t);let a=await _.Z.post(m.Hj,e,{headers:{"Content-Type":"multipart/form-data"},params:{from:f.id,to:p.id}});201===a.status&&(x.current.emit("send-msg",{to:p.id,from:f.id,message:a.data.message}),g({type:w.J.ADD_MESSAGE,newMessage:{...a.data.message},fromSelf:!0}))}catch(e){console.log(e)}},[{socket:x,currentChatUser:p,userInfo:f},g]=(0,c.C4)(),h=async()=>{try{t("");let{data:a}=await _.Z.post(m.co,{to:p.id,from:f.id,message:e});x.current.emit("send-msg",{to:p.id,from:f.id,message:a.message}),g({type:w.J.ADD_MESSAGE,newMessage:{...a.message},fromSelf:!0})}catch(e){console.log(e)}},v=()=>{l(!a)},y=(e,a)=>{t(t=>t+=e.emoji)},b=(0,n.useRef)(null);return(0,n.useEffect)(()=>{let e=e=>{"emoji-open"!==e.target.id&&b.current&&!b.current.contains(e.target)&&l(!1)};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[]),(0,n.useEffect)(()=>{t("")},[p]),(0,n.useEffect)(()=>{if(o){let e=document.getElementById("photo-picker");e.click(),document.body.onfocus=e=>{d(!1)}}},[o]),(0,s.jsxs)("div",{className:"bg-panel-header-background  h-20 px-4 flex items-center gap-6  relative",children:[!r&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex gap-6",children:[(0,s.jsx)(j.yFw,{className:"text-panel-header-icon cursor-pointer text-xl",title:"Emoji",onClick:v,id:"emoji-open"}),a&&(0,s.jsx)("div",{className:"absolute bottom-24 left-16 z-40",ref:b,children:(0,s.jsx)(I.ZP,{onEmojiClick:y,theme:"dark"})}),(0,s.jsx)(S.M8F,{className:"text-panel-header-icon cursor-pointer text-xl",title:"Attach",onClick:()=>d(!0)})]}),(0,s.jsx)("div",{className:"w-full rounded-lg h-10 flex items-center",children:(0,s.jsx)("input",{type:"text",placeholder:"Type a message",className:"bg-input-background text-sm focus:outline-none text-white h-10 rounded-lg pl-5 pr-5 py-4 w-full",value:e,onChange:e=>t(e.target.value)})}),(0,s.jsx)("div",{className:" w-10 flex items-center justify-center",children:e.length?(0,s.jsx)("button",{onClick:h,children:(0,s.jsx)(N.D6S,{className:"text-panel-header-icon cursor-pointer text-xl",title:"Send"})}):(0,s.jsx)(k.uYL,{className:"text-panel-header-icon cursor-pointer text-xl",title:"Record",onClick:()=>i(!0)})})]}),r&&(0,s.jsx)(A,{hide:i}),o&&(0,s.jsx)(T.Z,{onChange:u})]})}function D(){return(0,s.jsxs)("div",{className:"border-conversation-border border-l w-full bg-conversation-panel-background flex flex-col h-[100vh] z-10 ",children:[(0,s.jsx)(E,{}),(0,s.jsx)(h,{}),(0,s.jsx)(L,{})]})}var O=a(1163);function M(){let[{userInfo:e},t]=(0,c.C4)(),a=(0,O.useRouter)(),[l,r]=(0,n.useState)({x:0,y:0}),[i,o]=(0,n.useState)(!1),d=e=>{e.preventDefault(),r({x:e.pageX,y:e.pageY}),o(!0)},u=()=>{t({type:w.J.SET_ALL_CONTACTS_PAGE})};return(0,s.jsxs)("div",{className:"h-16 px-4 py-3 flex justify-between items-center",children:[(0,s.jsx)("div",{className:"cursor-pointer",children:(0,s.jsx)(v.Z,{type:"sm",image:null==e?void 0:e.profileImage})}),(0,s.jsxs)("div",{className:"flex gap-6 ",children:[(0,s.jsx)(j.Ohv,{className:"text-panel-header-icon cursor-pointer text-xl",title:"New chat",onClick:u}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j.FQA,{className:"text-panel-header-icon cursor-pointer text-xl",title:"Menu",onClick:e=>d(e),id:"context-opener"}),i&&(0,s.jsx)(C.Z,{options:[{name:"Logout",callBack:async()=>{o(!1),a.push("/logout")}}],cordinates:l,contextMenu:i,setContextMenu:o})]})]})]})}function J(e){let{data:t,isContactPage:a=!1}=e,[{userInfo:l,currentChatUser:n},r]=(0,c.C4)(),i=()=>{if(console.log("function",n,t,l),(null==n?void 0:n.id)===(null==t?void 0:t.id))return r({type:w.J.SET_ALL_CONTACTS_PAGE});a?(r({type:w.J.CHANGE_CURRENT_CHAT_USER,user:t}),r({type:w.J.SET_ALL_CONTACTS_PAGE})):r({type:w.J.CHANGE_CURRENT_CHAT_USER,user:{name:t.name,about:t.about,profilePicture:t.profilePicture,email:t.email,id:l.id===t.senderId?t.recieverId:t.senderId}})};return(0,s.jsxs)("div",{className:"flex cursor-pointer items-center ".concat((null==n?void 0:n.id)!==t.id||a?"hover:bg-background-default-hover":"bg-background-default-hover"),onClick:i,children:[(0,s.jsx)("div",{className:"min-w-fit px-5 pt-3 pb-1 ",children:(0,s.jsx)(v.Z,{type:"lg",image:null==t?void 0:t.profilePicture})}),(0,s.jsxs)("div",{className:"min-h-full flex flex-col justify-center mt-3 pr-2 w-full",children:[(0,s.jsxs)("div",{className:"flex justify-between ",children:[(0,s.jsx)("div",{children:(0,s.jsx)("span",{className:"text-white",children:null==t?void 0:t.name})}),!a&&(0,s.jsx)("div",{children:(0,s.jsx)("span",{className:"".concat(!t.totalUnreadMessages>0?"text-secondary":"text-icon-green"," text-sm"),children:(0,d.O)(t.createdAt)})})]}),(0,s.jsx)("div",{className:"flex border-b border-conversation-border pb-2 pt-1 pr-2",children:(0,s.jsxs)("div",{className:"flex justify-between w-full",children:[(0,s.jsx)("span",{className:"text-secondary line-clamp-1 text-sm ",children:a?(null==t?void 0:t.about)||"\xa0":(0,s.jsxs)("div",{className:"flex items-center gap-1 max-w-[200px] sm:max-w-[250px] md:max-w-[300px] lg:max-w-[200px] xl:max-w-[300px]",children:[t.senderId===l.id&&(0,s.jsx)(u.Z,{messageStatus:t.messageStatus}),"text"===t.type&&(0,s.jsx)("span",{className:"truncate ",children:t.message}),"audio"===t.type&&(0,s.jsxs)("span",{className:"flex gap-1 items-center",children:[(0,s.jsx)(k.uYL,{className:"text-panel-header-icon"}),"Audio"]}),"image"===t.type&&(0,s.jsxs)("span",{className:"flex gap-1 items-center",children:[(0,s.jsx)(k.Dmm,{className:"text-panel-header-icon"}),"Image"]})]})}),t.totalUnreadMessages>0&&(0,s.jsx)("span",{className:"bg-icon-green px-[5px] rounded-full text-sm",children:t.totalUnreadMessages})]})})]})]})}function P(){let[{userInfo:e,userContacts:t,filteredContacts:a},l]=(0,c.C4)();return(0,n.useEffect)(()=>{try{let t=async()=>{let{data:{users:t,onlineUsers:a}}=await _.Z.get("".concat(m.yQ,"/").concat(e.id));l({type:w.J.SET_USER_CONTACTS,userContacts:t}),l({type:w.J.SET_ONLINE_USERS,onlineUsers:a})};(null==e?void 0:e.id)&&t()}catch(e){console.error(e)}},[e]),(0,s.jsx)("div",{className:"bg-search-input-container-background flex-auto overflow-auto max-h-full custom-scrollbar",children:a&&a.length>0?a.map(e=>(0,s.jsx)(J,{data:e},e.id)):t.map(e=>(0,s.jsx)(J,{data:e},e.id))})}function R(){let[{contactSearch:e},t]=(0,c.C4)();return(0,s.jsxs)("div",{className:"bg-search-input-container-background flex py-3 pl-5 items-center gap-3 h-14",children:[(0,s.jsxs)("div",{className:"bg-panel-header-background flex items-center gap-5 px-3 py-1 rounded-lg flex-grow",children:[(0,s.jsx)("div",{children:(0,s.jsx)(y.wnI,{className:"text-panel-header-icon cursor-pointer text-l"})}),(0,s.jsx)("div",{className:"",children:(0,s.jsx)("input",{type:"text",placeholder:"Search or start new chat",className:"bg-transparent text-sm focus:outline-none text-white w-full",value:e,onChange:e=>t({type:w.J.SET_CONTACT_SEARCH,contactSearch:e.target.value})})})]}),(0,s.jsx)("div",{className:"pr-5 pl-3",children:(0,s.jsx)(y.lOx,{className:"text-panel-header-icon cursor-pointer text-xl "})})]})}var U=function(){let[{},e]=(0,c.C4)(),[t,a]=(0,n.useState)({}),[l,r]=(0,n.useState)(""),[i,o]=(0,n.useState)([]);return(0,n.useEffect)(()=>{if(l.length){let e={};Object.keys(t).forEach(a=>{e[a]=t[a].filter(e=>e.name.toLowerCase().includes(l.toLowerCase())),e[a].length||delete e[a]}),o(e)}else o(t)},[l]),(0,n.useEffect)(()=>{let e=async()=>{try{let{data:{users:e}}=await _.Z.get(m.To);a(e),o(e)}catch(e){console.log(e)}};e()},[]),(0,s.jsxs)("div",{className:"h-full flex flex-col",children:[(0,s.jsx)("div",{className:"h-24 flex items-end px-3 py-4",children:(0,s.jsxs)("div",{className:"flex  items-center gap-12 text-white",children:[(0,s.jsx)(y.YiX,{className:" cursor-pointer text-xl",onClick:()=>e({type:w.J.SET_ALL_CONTACTS_PAGE})}),(0,s.jsx)("span",{className:"",children:"New Chat"})]})}),(0,s.jsxs)("div",{className:"bg-search-input-container-background h-full flex-auto overflow-auto custom-scrollbar",children:[(0,s.jsx)("div",{className:" flex py-3 px-4 items-center gap-3 h-14",children:(0,s.jsxs)("div",{className:"bg-panel-header-background flex items-center gap-5 px-3 py-1 rounded-lg flex-grow",children:[(0,s.jsx)("div",{children:(0,s.jsx)(y.wnI,{className:"text-panel-header-icon cursor-pointer text-l"})}),(0,s.jsx)("div",{className:"",children:(0,s.jsx)("input",{type:"text",placeholder:"Search Contacts",className:"bg-transparent text-sm focus:outline-none text-white w-full",onChange:e=>r(e.target.value),value:l})})]})}),Object.entries(i).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-teal-light pl-10 py-5",children:t}),a.map(e=>(0,s.jsx)(J,{data:e,isContactPage:!0},e.id))]},Date.now()+t)})]})]})};function G(){let[e,t]=(0,n.useState)("default"),[{contactsPage:a}]=(0,c.C4)();return(0,n.useEffect)(()=>{a?t("all-contacts"):t("default")},[a]),(0,s.jsxs)("div",{className:"bg-panel-header-background flex flex-col max-h-screen z-20 ",children:["default"===e&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(M,{}),(0,s.jsx)(R,{}),(0,s.jsx)(P,{})]}),"all-contacts"===e&&(0,s.jsx)(U,{})]})}var V=a(4269),Z=function(){return(0,s.jsx)("div",{className:"border-conversation-border border-l w-full bg-panel-header-background flex flex-col h-[100vh] border-b-4 border-b-icon-green items-center justify-center",children:(0,s.jsx)(p(),{src:"/whatsapp.gif",alt:"whatsapp-gif",height:300,width:300})})};a(8);let F=o()(()=>Promise.resolve().then(a.bind(a,8)),{loadableGenerated:{webpack:()=>[8]},ssr:!1});var B=function(){let[{videoCall:e,socket:t,userInfo:a}]=(0,c.C4)();return(0,n.useEffect)(()=>{console.warn({videoCall:e})},[]),(0,n.useEffect)(()=>{"out-going"===e.type&&t.current.emit("outgoing-video-call",{to:e.id,from:{id:a.id,profilePicture:a.profileImage,name:a.name},callType:e.callType,roomId:e.roomId})},[e]),(0,s.jsx)(F,{data:e})};let z=o()(()=>Promise.resolve().then(a.bind(a,8)),{loadableGenerated:{webpack:()=>[8]},ssr:!1});var Y=function(){let[{voiceCall:e,socket:t,userInfo:a}]=(0,c.C4)();return(0,n.useEffect)(()=>{"out-going"===e.type&&t.current.emit("outgoing-voice-call",{to:e.id,from:{id:a.id,profilePicture:a.profileImage,name:a.name},callType:e.callType,roomId:e.roomId})},[e]),(0,s.jsx)(z,{data:e})},H=function(){let[{incomingVoiceCall:e,socket:t},a]=(0,c.C4)(),[l,r]=(0,n.useState)(null);(0,n.useEffect)(()=>{let e=new Audio("/call-sound.mp3");e.loop=!0,r(e)},[]),(0,n.useEffect)(()=>{if(l)return console.log({audioElement:l}),l.play(),()=>{l.pause(),l.currentTime=0}},[l]);let i=()=>{a({type:w.J.SET_INCOMING_VOICE_CALL,incomingVoiceCall:void 0}),a({type:w.J.SET_VOICE_CALL,voiceCall:{...e,type:"in-coming"}}),t.current.emit("accept-incoming-call",{id:e.id})},o=()=>{a({type:w.J.SET_INCOMING_VOICE_CALL,incomingVoiceCall:void 0}),t.current.emit("reject-voice-call",{from:e.id})};return(0,s.jsxs)("div",{className:"h-24 w-80 fixed bottom-8 mb-0 right-6 z-50 rounded-sm flex gap-5 items-center justify-start p-4 bg-conversation-panel-background text-white drop-shadow-2xl border-icon-green border-2 py-14",children:[(0,s.jsx)("div",{children:(0,s.jsx)(p(),{src:e.profilePicture,alt:"avatar",width:70,height:70,className:"rounded-full"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{children:e.name}),(0,s.jsx)("div",{className:"text-xs",children:"Incoming Voice Call"}),(0,s.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,s.jsx)("button",{className:"bg-red-500 p-1 px-3 text-sm rounded-full",onClick:o,children:"Reject"}),(0,s.jsx)("button",{className:"bg-green-500 p-1 px-3 text-sm rounded-full",onClick:i,children:"Accept"})]})]})]})},X=function(){let[{incomingVideoCall:e,socket:t},a]=(0,c.C4)(),[l,r]=(0,n.useState)(null);(0,n.useEffect)(()=>{let e=new Audio("/call-sound.mp3");e.loop=!0,r(e)},[]),(0,n.useEffect)(()=>{if(l)return l.play(),()=>{l.pause(),l.currentTime=0}},[l]);let i=()=>{console.warn({call:e}),a({type:w.J.SET_VIDEO_CALL,videoCall:{...e,type:"in-coming"}}),a({type:w.J.SET_INCOMING_VIDEO_CALL,incomingVideoCall:void 0}),t.current.emit("accept-incoming-call",{id:e.id})},o=()=>{a({type:w.J.SET_INCOMING_VIDEO_CALL,incomingVideoCall:void 0}),t.current.emit("reject-video-call",{from:e.id})};return(0,s.jsxs)("div",{className:"h-24 w-80 fixed bottom-8 mb-0 right-6 z-50 rounded-sm flex gap-5 items-center justify-start p-4 bg-conversation-panel-background text-white drop-shadow-2xl border-icon-green border-2 py-14",children:[(0,s.jsx)("div",{children:(0,s.jsx)(p(),{src:e.profilePicture,alt:"avatar",width:70,height:70,className:"rounded-full"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{children:e.name}),(0,s.jsx)("div",{className:"text-xs",children:"Incoming Video Call"}),(0,s.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,s.jsx)("button",{className:"bg-red-500 p-1 px-3 text-sm rounded-full",onClick:o,children:"Reject"}),(0,s.jsx)("button",{className:"bg-green-500 p-1 px-3 text-sm rounded-full",onClick:i,children:"Accept"})]})]})]})},Q=function(){let[{currentChatUser:e,messages:t},a]=(0,c.C4)(),[l,r]=(0,n.useState)(!1),[i,o]=(0,n.useState)(""),[u,m]=(0,n.useState)([]);return(0,n.useEffect)(()=>{i?m(t.filter(e=>"text"===e.type&&e.message.includes(i))):m([])},[i]),(0,s.jsxs)("div",{className:"border-conversation-border border-l w-full bg-conversation-panel-background flex flex-col  z-10 max-h-screen ",children:[(0,s.jsxs)("div",{className:"h-16 px-4 py-5 flex  gap-10 items-center bg-panel-header-background text-primary-strong",children:[(0,s.jsx)(b.bjh,{className:"cursor-pointer text-icon-lighter text-2xl",onClick:()=>a({type:w.J.SET_MESSAGES_SEARCH})}),(0,s.jsx)("span",{children:"Search Messages"})]}),(0,s.jsxs)("div",{className:"overflow-auto custom-scrollbar h-full",children:[(0,s.jsxs)("div",{className:"flex items-center flex-col w-full",children:[(0,s.jsx)("div",{className:" flex  px-5 items-center gap-3 h-14 w-full",children:(0,s.jsxs)("div",{className:"bg-panel-header-background flex items-center gap-5 px-3 py-[6px] rounded-lg flex-grow",children:[(0,s.jsx)("div",{children:l?(0,s.jsx)(y.YiX,{className:"text-icon-green cursor-pointer text-l"}):(0,s.jsx)(y.wnI,{className:"text-panel-header-icon cursor-pointer text-l"})}),(0,s.jsx)("div",{className:"",children:(0,s.jsx)("input",{type:"text",placeholder:"Search messages",className:"bg-transparent text-sm focus:outline-none text-white w-full",onFocus:()=>r(!0),onBlur:()=>r(!1),onChange:e=>o(e.target.value),value:i})})]})}),(0,s.jsx)("span",{className:"mt-10 text-secondary",children:!i.length&&" Search for messages with ".concat(e.name)})]}),(0,s.jsxs)("div",{className:"flex justify-center h-full flex-col",children:[i.length>0&&!u.length&&(0,s.jsx)("span",{className:"text-secondary w-full flex justify-center",children:"No messages found"}),(0,s.jsx)("div",{className:"flex flex-col w-full h-full  ",children:u.map(e=>(0,s.jsxs)("div",{className:"flex cursor-pointer flex-col justify-center hover:bg-background-default-hover w-full px-5  border-b-[0.1px]  border-secondary py-5",children:[(0,s.jsx)("div",{className:"text-sm text-secondary",children:(0,d.O)(e.createdAt)}),(0,s.jsx)("div",{className:"text-icon-green",children:e.message})]}))})]})]})]})};function K(){let[{userInfo:e,currentChatUser:t,videoCall:a,voiceCall:i,incomingVoiceCall:o,incomingVideoCall:d,messageSearch:u,userContacts:x},p]=(0,c.C4)(),f=(0,O.useRouter)(),g=(0,n.useRef)(),[h,v]=(0,n.useState)(!1),[j,y]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{h&&f.push("/login")},[h]),(0,l.Aj)(V.l,async t=>{if(t||v(!0),!e&&(null==t?void 0:t.email)){var a,s,l,n,r;let{data:e}=await _.Z.post(m.gS,{email:t.email});e.status||f.push("/login"),p({type:w.J.SET_USER_INFO,userInfo:{id:null==e?void 0:null===(a=e.data)||void 0===a?void 0:a.id,email:null==e?void 0:null===(s=e.data)||void 0===s?void 0:s.email,name:null==e?void 0:null===(l=e.data)||void 0===l?void 0:l.name,profileImage:null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.profilePicture,status:null==e?void 0:null===(r=e.data)||void 0===r?void 0:r.about}})}}),(0,n.useEffect)(()=>{e&&(g.current=(0,r.io)(m.M5),g.current.emit("add-user",e.id),p({type:w.J.SET_SOCKET,socket:g}))},[e]),(0,n.useEffect)(()=>{g.current&&!j&&(g.current.on("msg-recieve",e=>{p({type:w.J.ADD_MESSAGE,newMessage:{...e.message}})}),g.current.on("online-users",e=>{let{onlineUsers:t}=e;p({type:w.J.SET_ONLINE_USERS,onlineUsers:t})}),g.current.on("mark-read-recieve",e=>{let{id:t,recieverId:a}=e;p({type:w.J.SET_MESSAGES_READ,id:t,recieverId:a})}),g.current.on("incoming-voice-call",e=>{let{from:t,roomId:a,callType:s}=e;p({type:w.J.SET_INCOMING_VOICE_CALL,incomingVoiceCall:{...t,roomId:a,callType:s}})}),g.current.on("voice-call-rejected",()=>{p({type:w.J.SET_INCOMING_VOICE_CALL,incomingVoiceCall:void 0}),p({type:w.J.SET_VOICE_CALL,voiceCall:void 0})}),g.current.on("incoming-video-call",e=>{let{from:t,roomId:a,callType:s}=e;p({type:w.J.SET_INCOMING_VIDEO_CALL,incomingVideoCall:{...t,roomId:a,callType:s}})}),g.current.on("video-call-rejected",()=>{p({type:w.J.SET_INCOMING_VIDEO_CALL,incomingVideoCall:void 0}),p({type:w.J.SET_VIDEO_CALL,videoCall:void 0})}),y(!0))},[g.current]),(0,n.useEffect)(()=>{let a=async()=>{let{data:{messages:a}}=await _.Z.get("".concat(m.vp,"/").concat(e.id,"/").concat(t.id));p({type:w.J.SET_MESSAGES,messages:a})};t&&-1!==x.findIndex(e=>e.id===t.id)&&a()},[t]),(0,s.jsxs)(s.Fragment,{children:[o&&(0,s.jsx)(H,{}),d&&(0,s.jsx)(X,{}),a&&(0,s.jsx)("div",{className:"h-screen w-screen max-h-full max-w-full overflow-hidden",children:(0,s.jsx)(B,{})}),i&&(0,s.jsx)("div",{className:"h-screen w-screen max-h-full max-w-full overflow-hidden",children:(0,s.jsx)(Y,{})}),!a&&!i&&(0,s.jsxs)("div",{className:"grid grid-cols-main h-screen w-screen max-h-screen max-w-full overflow-hidden",children:[(0,s.jsx)(G,{}),t?(0,s.jsxs)("div",{className:u?"grid grid-cols-2":"grid-cols-2",children:[(0,s.jsx)(D,{}),u&&(0,s.jsx)(Q,{})]}):(0,s.jsx)(Z,{})]})]})}function W(){return(0,s.jsx)(K,{})}},58:function(e,t,a){"use strict";a.d(t,{CU:function(){return r},Hj:function(){return p},M5:function(){return s},MZ:function(){return o},OZ:function(){return x},To:function(){return i},co:function(){return d},gS:function(){return c},vp:function(){return u},yQ:function(){return m}});let s="http://localhost:5005",l="".concat(s,"/api/auth"),n="".concat(s,"/api/messages"),r="".concat(l,"/onboarduser"),c="".concat(l,"/check-user"),i="".concat(l,"/get-contacts"),o="".concat(l,"/generate-token"),d="".concat(n,"/add-message"),u="".concat(n,"/get-messages"),m="".concat(n,"/get-initial-contacts"),x="".concat(n,"/add-audio-message"),p="".concat(n,"/add-image-message")},157:function(e,t,a){"use strict";a.d(t,{O:function(){return s}});let s=e=>{let t=new Date(e),a=new Date;if(t.getUTCDate()===a.getUTCDate()&&t.getUTCMonth()===a.getUTCMonth()&&t.getUTCFullYear()===a.getUTCFullYear()){let e=t.toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric"});return e}if(t.getUTCDate()===a.getUTCDate()-1&&t.getUTCMonth()===a.getUTCMonth()&&t.getUTCFullYear()===a.getUTCFullYear())return"Yesterday";if(Math.floor((a-t)/864e5)>1&&7>=Math.floor((a-t)/864e5)){let e=new Date;e.setDate(a.getDate()-Math.floor((a-t)/864e5));let s=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e.getDay()];return s}{let e=t.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"});return e}}},4269:function(e,t,a){"use strict";a.d(t,{l:function(){return r}});var s=a(1259),l=a(3977);let n=(0,l.ZF)({apiKey:"AIzaSyD2i-vW6JTBnx8EzkIauU3QG081R_zEOAM",authDomain:"whatsapp-clone-55b30.firebaseapp.com",projectId:"whatsapp-clone-55b30",storageBucket:"whatsapp-clone-55b30.appspot.com",messagingSenderId:"180279867664",appId:"1:180279867664:web:4012ccc45a5ab1d0d58d95",measurementId:"G-KHVXD75VD7"}),r=(0,s.v0)(n)}},function(e){e.O(0,[551,445,260,228,609,13,874,307,772,354,964,774,888,179],function(){return e(e.s=5728)}),_N_E=e.O()}]);